mqtt:
  - sensor:
      state_topic: "heatpump/device/wlw286/state"
      value_template: ""
      default_entity_id: heatpump_device_wlw286
      unique_id: heatpump_device_wlw286
      device:
        identifiers:
          - wlw286
        name: Heat Pump

template:
  - sensor:
      - name: Wärmemenge Heizen
        unique_id: heatpump_waermemengen_heating_waermemenge_heizen
        device_class: energy
        state_class: total_increasing
        unit_of_measurement: kWh
        state: >
          {% set prefix = 'sensor.heatpump_waermemengen_heating_waermemenge_heizen_' %}
          {% set states = (prefix + '1_4', prefix + '5_8', prefix + '9_12') | map('states') | list %}
          {{
             states | map('float') | sum
             if (states | length) == (states | select('is_number') | list | length)
             else none
          }}
      - name: Wärmemenge Warmwasser
        unique_id: heatpump_waermemengen_tapwater_waermemenge_warmwasser
        device_class: energy
        state_class: total_increasing
        unit_of_measurement: kWh
        state: >
          {% set prefix = 'sensor.heatpump_waermemengen_tapwater_waermemenge_warmwasser_' %}
          {% set states = (prefix + '1_4', prefix + '5_8', prefix + '9_12') | map('states') | list %}
          {{
             states | map('float') | sum
             if (states | length) == (states | select('is_number') | list | length)
             else none
          }}
